# Показ видео рекламы

## На нашей стороне

### Формирование страницы. Сервер.
*  Перед вставкой ролика, мы формируем сессию *session_id*.
Все остальные действия или события привязаны именно к этому понятию.
*  Также в процессе участвует ID пользователя *uid*.

### Действия на клиенте посетителя.
*  Вставляем *session_id* и *uid* в iframe партнера как GET-параметры.
*  Далее мы ожидаем различные postMessage из iframe партнера.
*  Нам нужны по крайней мере три типа сообшений:
    *  Сообщение об ошибке, или что рекламы нет, чтобы продолжить обычную работу страницы
    *  Сообщение о начале проигрывания ролика.
    *  Сообщение об успешном завершении работы.
*  В случае успешного завршения работы мы отсылаем предварительные данные о просмотрах к себе на сервер.

## На стороне партнера

### Сервер.
*  Получив *session_id* партнер должен накапливать события по этой сессии.
*  Параметр *uid* партнер может использовать в своих целях, например лимитирую выдачу контента
*  Окончив собирать сведения о сессии, партнер должен положить ее в пул отправки.
*  В нужный для партнера момент (например получив подтвеждения оплаты от рекалмодателя) партнер отправляет подтверждение оплаты.
*  Отправка подтверждение оплаты осуществляется на специальный урл, предоставляемый после согласования.

## Необходимые данные при подтвержднении просмотра:

*  *session_id* - сессия.
*  *uid* - ID пользователя.
*  *count* - количество оплаченных роликов.
*  *amount* - итоговая сумма, начисленная нам от партнера за просмотр всех роликов.
*  *country* - страна, которую партенр зафиксировал для клиента пользователя.
