# StatsCommand

## Введение

**StatsCommand** это консольное приложение для расчета статистики по рекламным объявлениям.
Исходные данные заполняются с помощью хелпера **BannerStatistic**.

## Комманды

### Фикстуры

Используется для заполнения исходных таблиц тестовыми данными.

Из корневой папки проекта надо запустить

```bash
$> ./protected/yiic stats fixture --views=[просмотры] --start=[YYYY-MM-DD] --stop=[YYYY-MM-DD] --blocks=[views]
```

где

*views* &mdash; сколько просмотров страниц сгенерировать. Будет сгенерировано
от 80% до 120% запрошенных просмотров. По умолчанию 25&nbsp;000.

*start* &mdash; начальная дата генерации данных. Если не определять аргумент,
то данные сгенерируются за дату *stop*.

*stop* &mdash; конечная дата генерации данных. Если не определять аргумент,
то примет значение текущей даты.

*blocks* &mdash; за сколько просмотров будет осуществлятся вставка данных.
По умолчанию 1. Применяется для ускорения процесса генерации.

### Сведение данных

Для расчета сводных данных из корневой папки проекта надо запустить

```bash
$> ./protected/yiic stats summarize --limit=[записей] --force --verbose
```

где

*limit* &mdash; сколько записей будет обработано за проход внутри цикла. По умолчанию 10&nbsp;000.

*force* &mdash; принудительная обработка всех данных.

*verbose* &mdash; вывод отчета о происходящих действиях.

За один запуск будет совершен пересчет сводных записей за *первый день*.
*Первый день* вычисляется как самая старая дата, присутствующая в исходных данных.
После пересчета, если в исходных записях присутствуют данные за следующие за
*первым днем* даты, исходные таблицы будут очищены от всех записей старше
*первый день + 1*

Если выставлен флаг *force* будут обработаны данные за все даты.

## Установка

Необходимо прописать в *app/config/console.php*

```php
return [
    ...
    'import' => [
        ...
        'application.models.*',
        'application.interfaces.*',
        'application.traits.*',
        ...
    ],
    ...
];
```

Если же вы будете использовать фикстуры, также необходимо добавить

```php
return [
    ...
    'import' => [
        ...
        'application.components.*',
        ...
    ],
    ...
    'components' => [
        ...
        'stats' => [ 'class'=>'Statistic', ],
        ...
    ],
    ...
];
```
