# PatchCommand

## Введение

**PatchCommand** &mdash; консольное приложение, предназначенное для отслеживания изменений
в проектах, использующих [git](https://git-scm.com/).

Приложение поддерживает следующие возможности:

* Создание архива с изменениями, произошедшими с последнего коммита *git* и зафиксироваными
в репозитории
* Просмотр информации о конкретном патче
* Развертывание архива в локальный проект

Употребляется для тестирования изменений на сторонних серверах, без необходимости отправки
коммитов в *git-репозиторий*.

## Требования

* Приложение разработано под *Yii framework 1.1*
* Приложение разработано под среду Linux и обращается к следующим исполняемым файлам:
    * *cat* &mdash; осуществляет текстовый ввод/вывод
    * *git* &mdash; оболочка git-репозитория
    * *tar* &mdash; архиватор
* На уровень выше папки проекта *Yii framework* должна существовать папка
  **patches** c правом записи для исполнителя приложения.

## Использование

Все действия исполняются из консоли, например в интерпретаторе *bash*.

### Создание архива

Сначала нужно подготовить репозиторий.

Зайдите в папку проекта *Yii framework* и выполните

```bash
$> git status
```

*git* выведет все измененные файлы с момента последнего коммита. Все файлы
зеленого цвета (изменения, которые будут включены в коммит) попадут в патч.
Если зеленым отмечены не все нужные файлы, то их можно добавить коммандой

```bash
$> git add [filename]
```

Напротив, чтобы файл не попал в архив, можно отменить его добавление в следующий коммит командой

```bash
$> git reset [filename]
```

Теперь все готово и можно начать процесс

```bash
$> ./protected/yiic patch create
```

После вывода предварительной информации приложение запросит ввести комментарий

```bash
Введите пояснительный текст
(окончание ввода: Ctrl+D)
```

После этого будет создан файл-патч имеющий имя *patch_YYYY-MM-DD_hh-mm-ss.tar.gz*,

где

* YYYY &mdash; год,
* MM &mdash; месяц,
* DD &mdash; день,
* hh &mdash; час,
* mm &mdash; минута и
* ss &mdash; секунда создания архива.

### Просмотр информации о патче

Поместитие нужный файл патча в папку **patches**, а затем из папки проекта *Yii framework* выполните следующую комманду:

```bash
$> ./protected/yiic patch info --file=[filename]
```

где

*filename* - полный путь к файлу патча или же путь относительно папки **patches**,
например *patch_2017-01-26_23-35-48.tar.gz*.

Кроме того, *filename* может принимать значения *?first* и *?last*, тогда будет
отображена информация о первом или последнем по дате создания патче соответственно.
Значение по умолчанию *?last* и можно выполнить просто

```bash
$> ./protected/yiic patch info
```
### Применение патча

Перед применением патча **настоятельно рекомендуется** зафиксировать изменения в *git*

```bash
$> git commit
```

Тогда, если что-то пошло не так, всегда можно откатить изменения

```bash
$> git reset --hard
```

Патч применяется коммандой

```bash
$> ./protected/yiic patch apply [--file=?first] [--stepByStep] [--simulation] [--purify]
```

где

* *file* &mdash; путь к файлу патча. Значение по умолчанию *?first*.
Подробнее в подразделе [Просмотр информации о патче]().
* *stepByStep* &mdash; если ключ присутствует, то будет запрошена инструкци о действиях для каждого файла патча
* *simulation* &mdash; если ключ присутствует, то изменения в проект не внесутся.
* *purify* &mdash; если ключ присутствует, то удаляются оказавшиеся пустыми после патча папки.

Возможно, во время работы приложения вам будут заданы вопросы. Отвечать на них
следует вводом одного из символов, перечисленных в квадратных скобках в самом
конце вопроса. Например

```bash
Файл XXXXXX помечен как НОВЫЙ, однако он уже существует.
Заменить этот файл(O), переименовать(R) или пропустить(S)? [O/R/S]:
```

В данном случае нужно ввести одну из букв *O*, *R* или *S*. Регистр занчения не имеет.

При переименовании файлов проекта используется следующий механизм: если патч назывался
*patch_2017-01-26_23-35-48.tar.gz*, а файл &mdash; *file.ext*, то он будет переименован
в *file_2017-01-26_23-35-48.ext*.

## Советы

* Используйте патч как можно скорее после его создания.
* Не скапливайте патчи. В идеале &mdash; пользуйтесь только одним.
* Вы всегда можете использовать *git* для отката и создать новый патч.
