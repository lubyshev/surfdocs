1. Сделать много счетов спод типами. Например

Это пока можно не делать, потом для контроля добавим
000 000 000 0 - Счет, общий - для учета всех операций по сайту

Это для юзеров

001 000 000 708958 - Мой счет, общий, в рублях

003 000 000 708958 - Мой счет рекламного баланса, общий, в рублях

003 001 000 708958 - Мой счет рекламного баланса для баннеров, в рублях

003 002 000 708958 - Мой счет рекламного баланса для видео, в рублях

...

099 000 000 708958 - Мой счет на кошельки, общий, в рублях

099 001 000 708958 - Мой счет на кошелек QIWI, общий, в рублях


2. Сделать транзакции, можно даже именованные

пополнить рекламный баланс на 100 рублей пошли проводки:

001 000 000 = - 100 рублей ( Мой счет, общий, в рублях )
003 000 000 = + 100 рублей ( Мой счет рекламного баланса, общий, в рублях )

пополнить рекламный бюджет видео на 100 рублей пошли проводки:

003 000 000 = - 100 рублей ( Мой счет рекламного баланса, общий, в рублях )
003 002 [ID видео] = + 100 рублей ( Мой рекламного баланса для видео, общий, в рублях )

3. Таблица План счетов
id type subtype name

4. Таблица Cчета
id plan_id uid subject_id key_code saldo created_at

5. Таблица Cчета_дейли ( для закрытия дня и статы )
id account_id dt saldo_start saldo_end debet credit

6. Таблица проводки
id dt account_debet account_credit amount

7. Сделать родительский класс для транзакций где типа так

