# CampaignsCommand

## Введение

**CampaignsCommand** это консольное приложение для мониторинга и обслуживания
различных кампаний проекта.

## Настройка

*Диспетчер кампаний* работает в непрерывном цикле в течении некоторого времени.
Поэтому нужно уделить особое внимание некоторым настройкам класса. Возможно,
оптимальные параметры придется подбирать опытным путем.

### CACHE_KEY_STARTED
Константа содержит имя ключа в кеше, который будет хранить информацию о времени запуска
исполняемого в этот момент *Диспетчера кампаний*. В настройке не нуждается.

### CACHE_KEY_STOP
Константа содержит имя ключа в кеше, который будет установлен для завершения
работы *Диспетчера кампаний*. В настройке не нуждается.

### CACHE_KEY_STARTED_TTL

Время жизни в кеше ключа **CACHE_KEY_STARTED** в секундах.
Должно быть раза в полтора больше чем время полного исполнение цикла, включая
**SLEEP_TIME**.

Время полного исполнение зависит от параметра *--limit* при запуске *Диспетчера кампаний*,
а так же от скопившейся очереди событий. Можно узнать из лога исполнения.

### MAX_EXECUTION_TIME
Время исполнения в секундах, по прошествии которого *Диспетчер кампаний* завершит свое исполнение.
Нужно расчитать время перезапуска задачи в кроне так, чтобы по просшествии этого времени,
*Диспетчер кампаний* простаивал оптимальное время.

### SLEEP_TIME
Сколько времени в секундах *Диспетчер кампаний* будет бездействовать по завершении
каждой своей итеррации.

## Комманды

### Запуск диспетчера кампаний

Из корневой папки проекта надо запустить

```bash
$> ./protected/yiic campaigns scan [--limit=100] [--verbose]
```

где

*limit* &mdash; сколько обрабатывать записей за одну иттерацию.

*verbose* &mdash; вывод отчета о происходящих действиях.


### Остановка диспетчера кампаний

Для остановки *Диспетчера кампаний* из корневой папки проекта надо запустить

```bash
$> ./protected/yiic campaigns stop [--verbose]
```

где

*verbose* &mdash; вывод отчета о происходящих действиях.

Используется для корректного завершения работы *Диспетчера кампаний* или в
случае "вылета" при возникновении ошибки. При такой остановке *Диспетчера кампаний*
очищаются все рабочие данные, которые могут повлиять на последующий запуск.
